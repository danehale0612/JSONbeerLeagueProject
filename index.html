<!DOCTYPE HTML>
<html>

<head>

<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="js/schedule.js"></script>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="css/beerLeagueProject.css" rel="stylesheet">

<script type="text/javascript" src="js/bootstrap.min.js"></script>


<!-- <script type="text/javascript" src="test.js" /> -->



<script>

var s = new Array(); // variable for schedule
	var score = {};
	var week = 0;
	var game = 0;

$(document).ready(function() {


	//************************ Global variables *****************

	var league = new Array();
	




	//**************** GET ajax *******************


	$.ajax({
	url: "backliftapp/database",
	type: "GET",
	dataType: "json",
	success: function (data) {
		for(var i = 0; i < data.length; i++) {
			addTeamToTable(data[i]);
		}
		league = data;
		schedule();
	}

	}); //End of ajax



	//************** League Full click function ***************

	$('a.btn').click(function() {
		if (league.length<8) {
			
		} else {
			$('a[data-toggle="modal"]').attr('data-toggle', 'false');
			alert("League is Full. Delete a team to add another one.")
		}
		});//End of a.click



	//************* submit button and post funciton ***************

	$('#submitData').click(function() {
		teamObject = {
		teamName: $("#teamName").val(),
		mgrFirstName: $("#mgrFirstName").val(),
		mgrLastName: $("#mgrLastName").val(),
		phone: $("#phone").val(),
		sponsor: $("#sponsor").val(),
		zipCode: $("#zipCode").val(),
		};

		$.ajax({
			url: "backliftapp/database",
			type: "POST",
			dataType: "json",
			data: teamObject,
			success: function (data) {
				addTeam(data);
				league.push(data);
				schedule();
			}
		});
		
		clearForm();

	}); // End of submitData.click




	//***************** when page loads, what the GET ajax gets *****************


	function addTeamToTable(teamObject) {
	  // var percent = (parseInt(team.wins)/(parseInt(team.wins)+parseInt(team.losses))).toFixed(3);
	  $("#standings table").html(" ");
	  $('<tr><td class="teamName"> <a href="#" id="popOver" title="Manager: '+teamObject.mgrFirstName+' '+teamObject.mgrLastName+'; '+'Phone Number: '+teamObject.phone+'; '+'Sponsor: '+teamObject.sponsor+'; '+'Zip Code: '+teamObject.zipCode+'">'+ teamObject.teamName +'</a></td><td>?</td><td>?</td><td>?</td>'+'<td><button id="deleteButton" type="submit" class="btn" data-dismiss="modal" aria-hidden="true" onclick="deleteTeam(\'' + teamObject.id + '\')">delete</button></td></tr>').appendTo('#standings');

	  	

		};// End of addTeamToTable





	//****************** function for what the "Add Team" form submits to the database***


	function addTeam (teamObject) {
		$("#standings table").html(" ");
		$('#standings').append('<tr><td class="teamName"> <a href="#" id="popOver" title="Manager: '+teamObject.mgrFirstName+' '+teamObject.mgrLastName+'; '+'Phone Number: '+teamObject.phone+'; '+'Sponsor: '+teamObject.sponsor+'; '+'Zip Code: '+teamObject.zipCode+'">'+ teamObject.teamName +'</a></td><td>?</td><td>?</td><td>?</td></td>'+'<td><button id="deleteButton" type="submit" class="btn" data-dismiss="modal" aria-hidden="true" onclick="deleteTeam(\'' + teamObject.id + '\') ">delete</button></td></tr>');

		schedule();

		}; // End of addTable



	//**********************Clear Form function*****************************

	function clearForm () {
		$('.team_inputs').each(function () {
			$(this).val('');
		})
		}; // End of clearForm



	




	//******************* Schedule function **********************************
	function schedule () {

		if (league.length === 4) {
			s = blankSchedule4;
		} else if (league.length === 5 || league.length === 6) {
			s = blankSchedule6;
		} else if (league.length === 7 || league.length === 8) {
			s = blankSchedule8;
		} else {
			$('<p>No schedule on current amount of teams.</p>').appendTo('#gameSchedules');
		};

		// End of if statement

		$('#gameSchedules').html(" ");
		
		//****** Adding a table for schedule info ********
		
		
		for (var i = 0; i < s.length; i++) {

			
			$('#gameSchedules').append('<div class="row"><div class="span3 box"><h4>Week'+(i+1)+'</h4></div><div class="span3 box"><a href="#myModal'+i+'" role="button" class="btn" data-toggle="modal">Enter Scores</a></div></div><div class="row"><div class="span8 box"><table id="teamSchedules'+i+'" class="table table-striped"><tr><th>Match</th><th>score</th></tr></table></div></div>');
			$('.afterModal').before('<div id="myModal'+i+'" class="modal hide fade scoreForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 320px;"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3 id="myModalLabel">Enter Scores:</h3></div><div class="modal-body modalScores"><form class="hello"><button id="enterScores'+i+'" type="submit" class="btn submitScores" data-dismiss="modal" aria-hidden="true" style="margin-top: 20px;" onClick="pass('+i+')">Submit</button></form></div></div>');

			if (league.length % 2 === 0){ //even number of teams
				var j = 0;
			} else { //Odd number of teams
				var j = 1;
				$('#teamSchedules'+i+'').append('<tr><td>'+league[s[i][0][1]-2].teamName + '</td><td>Bye Week</td></tr>');
			};

			while (j < s[i].length) {

				if (league.length % 2 === 0) {
					var homeTeam = league[s[i][j][0]-1].teamName;
					var awayTeam = league[s[i][j][1]-1].teamName;
				} else {
					var homeTeam = league[s[i][j][0]-2].teamName;
					var awayTeam = league[s[i][j][1]-2].teamName;
				};

			
			$('#teamSchedules'+i+'').append('<tr id="teamMatchUp'+i+'-'+j+'"><td>'+ homeTeam + ' vs ' + awayTeam + '</td></tr>');
			$('#enterScores'+i+'').before('<table id="scoresTable'+i+'" class="tableScores"><tr><td>'+ homeTeam + '<input id="homeTeamScore'+j+'" class="team_scores" type="text" name="homeTeamScore" style="width: 40px; margin: 0px 5px;"> <strong>vs</strong> ' + awayTeam + '<input id="awayTeamScore'+j+'" class="team_scores" type="text" name="awayTeamScore" style="width: 40px; margin: 0px 5px;"></td></tr></table>');
			
			
			
			j++;
			
			

		};// End of while loop
			game = j;

		}; // End of for loop

		

		$('.submitScores').click(function() {
		var i = $(this).parents('.scoreForm').attr('id');
		var z = new Array();

		

		validIds(z);
		// console.log(i);
		// console.log(z);
		// console.log(z.length);
		
		pushToScore(z,i);

		displayScore(week, game);
		
		

		// console.log(score['homeTeam2']);

			// 


			// console.dir(score);

				
			console.log(score);
		// for (var q = 0; q<s.length; q++) {
		// 	$(this).parents('.scoreForm').nextAll('#gameSchedules').find('#teamSchedules'+w).find('.teamMatchUp'+g).append('<td>'+score.homeTeam+g+' - '+score.awayTeam+g+'</td>');
		// };

		
	}); //End of click

	
	}; // End of schedule funciton

	

	


}); //End of doc.ready

	function deleteTeam (id) {
			  var conf = confirm("Are you sure you want to delete this team?");
			  if (conf == true) {
			    $.ajax({
			      url: "backliftapp/database/" + id,
			      type: "DELETE",
			      dataType: "json"
			    });
			    //$(this).siblings('td').remove();
			};
			location.reload();
	} // End of deleteTeam

	function addScoreForm () {
		$('#gameSchedules').append('<div class="row"><div class="span3 box"><h4>Week'+(i+1)+'</h4></div><div class="span3 box"><a href="#myModal'+i+'" role="button" class="btn" data-toggle="modal">Enter Scores</a></div></div><div class="row"><div class="span8 box"><table id="teamSchedules'+i+'" class="table table-striped"><tr><th>Match</th><th>score</th></tr></table></div></div>');
			$('.afterModal').before('<div id="myModal'+i+'" class="modal hide fade scoreForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 320px;"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3 id="myModalLabel">Enter Scores:</h3></div><div class="modal-body modalScores"><form><button id="enterScores'+i+'" type="submit" class="btn submitScores" data-dismiss="modal" aria-hidden="true" style="margin-top: 20px;">Submit</button></form>');

	};

	

		function pass(i) {
			week = i;
			console.log(week);
			};

			function displayScore(week, game) {
				for (var q = 0; q<game; q++) {
			$('#teamMatchUp'+ week +'-'+q).append('<td>'+ score['homeTeam' + q] + ' - '+ score['awayTeam' + q] +'</td>');
				// alert(score.awayTeam+q);
			};
			};

			function pushToScore(z,i) {
				hti = 0; //Home Team Index
				ati = 0; // Away Team Index
				for (var j = 0; j<z.length; j++) {
					if (j % 2 === 0) {
					score['homeTeam'+hti] = $("#"+i + " "+z[j]+"").val();
					hti++;
					} else {
					score['awayTeam'+ati] = $("#"+i + " "+z[j]+"").val();
					ati++;
					}
				};
		};


		function validIds (z) {
		if ($('#homeTeamScore0').val() !== undefined) {
			(z).push('#homeTeamScore0');
		} else {
			console.log('undefined');
		}

		if ($('#awayTeamScore0').val() !== undefined) {
			(z).push('#awayTeamScore0');
		} else {
			console.log('undefined');
		}

		if ($('#homeTeamScore1').val() !== undefined) {
			(z).push('#homeTeamScore1');
		} else {
			console.log('undefined');
		}

		if ($('#awayTeamScore1').val() !== undefined) {
			(z).push('#awayTeamScore1');
		} else {
			console.log('undefined');
		}

		if ($('#homeTeamScore2').val() !== undefined) {
			(z).push('#homeTeamScore2');
		} else {
			console.log('undefined');
		}

		if ($('#awayTeamScore2').val() !== undefined) {
			(z).push('#awayTeamScore2');
		} else {
			console.log('undefined');
		}

		if ($('#homeTeamScore3').val() !== undefined) {
			(z).push('#homeTeamScore3');
		} else {
			console.log('undefined');
		}

		if ($('#awayTeamScore3').val() !== undefined) {
			(z).push('#awayTeamScore3');
		} else {
			console.log('undefined');
		}
		};// End of validIds function
	

</script>


</head>

<body>

	<div class="container">

		<div class="row blah">
			<div class="span12 box">
				<h1>Beer and Veggie Dogs? League</h1>
				<h3>Standings</h3>
			</div>
		</div> <!--end of row -->

		<div class ="row">
			<div class="span12 box">
				<table id="standings" class="table table-striped">
					<tr><th>Team</th><th>Wins</th><th>Loses</th><th>Season W/L%</th><th>Edit</th></tr>
				</table>
			</div>
		</div> <!-- End of row -->
		
				<a href="#myModal" role="button" class="btn" data-toggle="modal">Add New Team</a>
			
		
		<!-- <p><b>Results:</b> <span id="results"></span></p> -->
 
				<!-- Modal -->
				<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-header">
				    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				    <h3 id="myModalLabel">Team Info:</h3>
				  </div>
				  <div class="modal-body">



				  	<form>
				    
					  <label for="getTeamName">Team Name:</label>
					  <input id="teamName" class="team_inputs" type="text" name="teamName">

					  <h5 id="managerInfoTitle">Manager Info:</h5>

					  <label for="getManagerFirstName" id ="managerFirstName">First Name:</label>
					  <input id="mgrFirstName" class="team_inputs" type="text" name="managerFirstName">

					  <label for="getManagerLastName" id="managerLastName" >Last Name:</label>
					  <input id="mgrLastName" class="team_inputs" type="text" name="managerLastName">

					  <label for="getPhoneNumber">Phone Number:</label>
					  <input id="phone" class="team_inputs" type="text" name="phoneNumber">

					  <label for="getSponsor">Sponsor:</label>
					  <input id="sponsor" class="team_inputs" type="text" name="sponsor">

					  <label for="getZipCode">Zip Code:</label>
					  <input id="zipCode" class="team_inputs" type="text" name="zipCode"><br>

					  
					  <button id="submitData" type="submit" class="btn" data-dismiss="modal" aria-hidden="true">Submit</button>
					</form>

					
				  <!-- <div class="modal-footer">
				    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
				    <button class="btn btn-primary">Save changes</button> -->
				  </div>
				</div>







				<!-- <div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-header">
				    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				    <h3 id="myModalLabel">Enter Scores:</h3>
				  </div>
				  <div class="modal-body modalScores"> -->
				  	

				  	<!-- <form id="enterScores">
					  
					  <button id="submitScore" type="submit" class="btn" data-dismiss="modal" aria-hidden="true">Submit</button>
					</form> -->

					
				  <!-- <div class="modal-footer">
				    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
				    <button class="btn btn-primary">Save changes</button> -->
				  <!-- </div>
				</div> -->






	<div class="row afterModal">
			<div id="show" class="span12 box">
		
			
			</div>
	</div> <!--end of row-->

	
	<div class="row startOfSchedules">
		<div class="span6 box">
	           <h3>Game Schedule</h3>
	    </div>
	</div>



	  <div id="gameSchedules">
	  	
	   </div>
	    
    



	</div> <!-- End of container -->
</body>
</html>